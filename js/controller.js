(()=>{var t=!1;Vue.component("modalWin",{props:{title:{type:String,default:""},content:{type:String,default:""}},data:function(){return{}},methods:{close:function(){this.$emit("close")}},computed:{},template:'<div class="mod_win_wrapper" style=\'background: rgba(0, 0, 0, 0.7);\' @click="close" @scroll.stop>\n\t<div class="mod_win">\n\t\t<span class="bCloseInfoWin" @click="close">√ó</span>\n\t\t<div class="mod_win_content" v-html="content">\n\t\t</div>\t\n\t</div>\n</div>'}),Vue.component("searchfield",{props:{id:{type:String,default:""},title:{type:String,default:""},value:{type:String,default:""},ios:{type:Boolean,default:!1}},data:function(){return{}},methods:{input:function(t){this.$emit("input",t.target.value)},clear:function(){this.$emit("input","")},random:function(){this.$emit("searchrndom")}},computed:{innerId:function(){return"sf_"+this.id}},template:'<div :id="id">\n\t<label class=\'filterLabel\' :for="innerId">{{title}}</label>\n\t<div style="display: flex">\n\t\t<div class="customInput">\n\t\t\t<textarea v-if="ios" :id="innerId"  @input="input" rows=1 style="width:100%; height: 3rem; font-size:110%">{{value}}</textarea>\n\t\t\t<input v-else :id="innerId" type="text" :value=\'value\' @input="input">\n\t\t\t<span class="cross" @click="clear"></span>\n\t\t</div>\n\t\t<a href="#random" class="bt flexChild" id="bRandom" title="–°–ª—É—á–∞–π–Ω–æ–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ" @click.stop="random">üé≤</a>\n\t</div>\n</div>'}),Vue.component("check-button",{props:{id:{type:String,default:""},title:{type:String,default:""},tooltip:{type:String,default:""},checked:{type:Boolean,default:!1}},data:function(){return{}},methods:{press:function(t){this.$emit("press")}},computed:{innerId:function(){return"chb_"+this.id},value:function(){return this.checked?"checked='checked'":""}},template:'<div :id="id" class="customCheckbox" @click.stop="press" :title="tooltip">\n\t<input type="checkbox" :id="innerId" :checked="checked">\n\t<span class="label">{{title}}</span>\n</div>'}),Vue.component("hiddenitem",{props:{id:{type:String,default:""},title:{type:String,default:""},tooltip:{type:String,default:""}},data:function(){return{}},methods:{unhide:function(t){this.$emit("unhide",t)}},computed:{},template:"<a href='#' @click.stop=\"unhide\">{{title}} ({{tooltip}})</a>"}),Vue.component("comboboxItem",{props:{val:{type:String,default:"0"},title:{type:String,default:""},subtitle:{type:String,default:""},checked:{type:Boolean,default:!1}},data:function(){return{}},methods:{labelClick:function(t){this.$emit("lclick",this.val)}},computed:{id:function(){return"ch_"+this.val},label:function(){let t=this.subtitle?"<span class='subtitle'>"+this.subtitle+"</span>":"";return this.title+t}},created:function(){},template:'<div>\n\t<input type="checkbox" :value="val" :id="id" :checked="checked">\n\t<label data-hierarchy="root" v-html="label" @click="labelClick"></label>\n</div>'}),Vue.component("combobox",{props:{value:{type:String,default:"0"},id:{type:String,default:""},title:{type:String,default:"#7986CB"},items:{type:Array,default:[]},opened:{type:Boolean,default:!1}},data:function(){return{open:null}},computed:{isOpen:function(){return null!=this.open?this.open:this.opened||!1}},methods:{toggle:function(t,e){this.open=null!=e?e:!this.open;let s=$("#"+this.id).find(".combo_box_content");this.open?s.slideDown(400,function(){this.$emit("opened",!0)}.bind(this)):s.slideUp(400,function(){this.$emit("opened",!1)}.bind(this))},itemclick:function(t){this.$emit("iclick",t)}},mounted:function(){this.isOpen||$("#"+this.id).find(".combo_box_content").hide()},template:'<div :id="id" class="combo_box" :data-text="title" >\n\t<div class="combo_box_title" @click="toggle">{{title}}</div>\n\t\t<div class="combo_box_content">\n\t\t\t<comboboxItem v-for="item in items"\n\t\t\t\t:key="item.key"\n\t\t\t\t:val="item.key"\n\t\t\t\t:checked="item.checked"\n\t\t\t\t:title="item.title"\n\t\t\t\t:subtitle="item.subtitle"\n\t\t\t\t@lclick="itemclick"\n\t\t\t>\n\t\t\t</comboboxItem>\n\t\t</div>\n\t<div class="combo_box_arrow" @click="toggle">\n\t\t<span class="arr_down" v-show="!isOpen">\n\t\t\t<i class="fa fa-arrow-down"></i>\n\t\t</span>\n\t\t<span class="arr_up" v-show="isOpen">\n\t\t\t<i class="fa fa-arrow-up"></i>\n\t\t</span>\n\t</div>\n</div>'}),Vue.component("custom-select",{props:{selected:{type:String,default:""},id:{type:String,default:""},title:{type:String,default:""},items:{type:Array,default:[]},bOpen:{type:Boolean,default:!1}},data:function(){return{open:null}},computed:{isOpen:function(){return null!=this.open?this.open:this.bOpen||!1}},methods:{toggle:function(){this.open=!this.open;let t=$("#"+this.id).find(".list");this.open?t.slideDown(200):t.slideUp(300)},itemclick:function(t){this.toggle(),this.$emit("iclick",t)}},mounted:function(){this.isOpen||$("#"+this.id).find(".combo_box_content").hide()},template:'<div :id="id">\n\t<label class=\'filterLabel\' v-if="title.length>0">{{title}}</label>\n\t<div  class="customSelect" @click="toggle">\n\t\t<div class="label">{{selected}}</div>\n\t\t<ul class="list" style="display: none;">\n\t\t\t<li \n\t\t\t\tv-for="item in items"\n\t\t\t\t:key="item.key"\n\t\t\t\tclass="option"\n\t\t\t\tv-html="item.title" \n\t\t\t\t@click.stop="itemclick(item.key)"\n\t\t\t\t></li>\n\t\t</ul>\n\t</div>\n</div>'}),Vue.component("card",{props:{name:{type:String,default:""},tooltip:{type:String,default:""},id:{type:String,default:""},castingTimeTitle:{type:String,default:"Casting time"},castingTime:{type:String,default:""},rangeTitle:{type:String,default:"Range"},range:{type:String,default:""},componentsTitle:{type:String,default:"Components"},components:{type:String,default:""},durationTitle:{type:String,default:"Duration"},duration:{type:String,default:""},materials:{type:String,default:""},text:{type:String,default:""},className:{type:String,default:""},level:{type:String,default:""},school:{type:String,default:""},src:{type:String,default:""},source:{type:String,default:""},ritual:{type:String,default:""},color:{type:String,default:""},view:{type:String,default:"card"},selected:{type:Boolean,default:!1},locked:{type:Boolean,default:!1},type:{type:String,default:""},pre:{type:String,default:""},editable:{type:Boolean,default:!1}},data:function(){return{viewClass:"cardView",textSize:"",cardWidth:""}},computed:{mainClass:function(){return"card"==this.view?"cardContainer":"textCardContainer"},srcTitle:function(){return"–ò—Å—Ç–æ—á–Ω–∏–∫: "+this.source},materialsLine:function(){return this.materials?"("+this.materials+")":""},cardView:function(){return"card"==this.view},typeClass:function(){let t=this.color.toLowerCase();switch(t){case"skill proficiency":t="skill";break;case"tool proficiency":t="tool";break;case"world-specific":t="world"}return t},selectedClass:function(){return this.selected?"selected":""},colorClass:function(){return this.color?this.color:""},preparedText:function(){return this.text?this.text.split(/<br>/g).map((t=>"<p>"+t+"</p>")).join(""):""},ItemCard:function(){return"spellCard"},prerequisite:function(){return this.pre.length>0?"<span title='–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è'>["+this.pre+"]</span>":""},ritualMark:function(){return this.ritual?"("+this.ritual+") ":""},textSizeStyle:function(){return this.textSize?"font-size: "+this.textSize+"px":""},cardWidthStyle:function(){return this.cardWidth>0&&this.cardView?"width: "+this.cardWidth+"px":""},editableButtons:function(){return this.editable?"":"display: none"}},mounted:function(){let t=this.$refs.itemText,e=window.getComputedStyle(t,null).getPropertyValue("font-size");this.textSize=parseFloat(e);let s=this.$refs.cardContainer,i=window.getComputedStyle(s,null).getPropertyValue("width");this.cardWidth=parseFloat(i)},methods:{lock:function(t){this.$emit("lock",t)},unlock:function(t){this.$emit("unlock",t)},hide:function(t){this.$emit("hide",t)},select:function(t){return this.$emit("select",t),!1},onTextMin:function(){this.textSize--},onTextMax:function(){this.textSize++},onTextCancel:function(){this.$emit("cancel",{id:this.id})},onTextSave:function(t){let e=this.$refs.itemText.innerHTML;this.$emit("input",{id:this.id,text:e})},autosizeText:function(){let t=this.$refs.itemText;return window.getComputedStyle(t,null).getPropertyValue("scrollWidth"),this.textSize>7&&t.scrollHeight>t.offsetHeight&&(this.textSize-=.3,!0)},onCardWidthMax:function(){this.cardWidth+=10},onCardWidthMin:function(){this.cardWidth-=10},setCardWidth:function(t){this.cardWidth=t}},template:'<div :class="[mainClass, viewClass, colorClass]" @click.ctrl="select" v-on:dblclick.stop="select" ref="cardContainer" :style="cardWidthStyle">\n\t\t\t\t<div :class=\'[ItemCard, selectedClass]\' v-if="cardView" >\n\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t<span v-show="locked" class="bUnlockItem" title="–û—Ç–∫—Ä–µ–ø–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ" @click.stop="unlock"><i class="fa fa-unlock-alt" aria-hidden="true"></i></span>\n\t\t\t\t\t\t<span v-show="!locked" class="bLockItem" title="–ó–∞–∫–æ—Ä–µ–ø–∏—Ç—å –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ (–Ω–µ –±—É–¥—É—Ç –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã)" @click.stop="lock"><i class="fa fa-lock" aria-hidden="true"></i></span>\n\t\t\t\t\t\t<span class="bHideItem" title="–°–∫—Ä—ã—Ç—å –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ (–±—É–¥–µ—Ç –≤–Ω–∏–∑—É –ø–∞–Ω–µ–ª–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤)" @click.stop="hide"><i class="fa fa-eye-slash" aria-hidden="true"></i></span>\n\t\t\t\t\t\t<h1 :title="tooltip" :contenteditable="editable">{{name}} {{ritualMark}}</h1>\n\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t<div class="cell castingTime" :contenteditable="editable">\n\t\t\t\t\t\t\t\t<b>{{castingTimeTitle}}</b>\n\t\t\t\t\t\t\t\t<span>{{castingTime}}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="cell range" :contenteditable="editable">\n\t\t\t\t\t\t\t\t<b>{{rangeTitle}}</b>\n\t\t\t\t\t\t\t\t<span>{{range}}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="row">\n\t\t\t\t\t\t\t<div class="cell components" :contenteditable="editable">\n\t\t\t\t\t\t\t\t<b>{{componentsTitle}}</b>\n\t\t\t\t\t\t\t\t<span>{{components}}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="cell duration" :contenteditable="editable">\n\t\t\t\t\t\t\t\t<b>{{durationTitle}}</b>\n\t\t\t\t\t\t\t\t<span>{{duration}}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="materials" :contenteditable="editable">{{materials}}</div>\n\t\t\t\t\t\t<div class="text" v-html="preparedText" :style="textSizeStyle" ref="itemText" :contenteditable="editable">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div class="sizeButtonsContainer noprint">\n\t\t\t\t\t\t\t<span class="textMin itemButton" title="–£–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞" @click.stop=\'onTextMin\'>‚Äì</span>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<span class="textCancel itemButton" title="–û—Ç–º–µ–Ω–∏—Ç—å" @click.stop=\'onTextCancel\' :style="editableButtons">‚úñ</span>\n\t\t\t\t\t\t\t<span class="textSave itemButton" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" @click.stop=\'onTextSave\' :style="editableButtons">‚úî</span>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<span class="textMax itemButton" title="–£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞" @click.stop=\'onTextMax\'>+</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<b class="class">{{className}}</b>\n\t\t\t\t\t\t<b class="school">{{level}}, {{school}} <span :title="srcTitle">({{src}})</span></b>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div class="inner" v-if="!cardView">\n\t\t\t\t\t<span v-show="locked" class="bUnlockItem noprint" title="–û—Ç–∫—Ä–µ–ø–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ" @click.stop="unlock"><i class="fa fa-unlock-alt" aria-hidden="true"></i></span>\n\t\t\t\t\t<span v-show="!locked" class="bLockItem noprint" title="–ó–∞–∫–æ—Ä–µ–ø–∏—Ç—å –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ (–Ω–µ –±—É–¥—É—Ç –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã)" @click.stop="lock"><i class="fa fa-lock" aria-hidden="true"></i></span>\n\t\t\t\t\t<span class="bHideItem noprint" title="–°–∫—Ä—ã—Ç—å –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ (–±—É–¥–µ—Ç –≤–Ω–∏–∑—É –ø–∞–Ω–µ–ª–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤)" @click.stop="hide"><i class="fa fa-eye-slash" aria-hidden="true"></i></span>\n\t\t\t\t\t<div class="flex">\n\t\t\t\t\t\t<div class="flex column primal">\n\t\t\t\t\t\t\t<h1 :title="tooltip" :contenteditable="editable">{{name}}</h1>          \n\t\t\t\t\t\t\t<div class="second_name" :contenteditable="editable">[{{tooltip}}]</div>\n\t\t\t\t\t\t\t<div class="school_level" :contenteditable="editable">{{level}}, {{school}} {{ritualMark}}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="flex secondal">\n\t\t\t\t\t\t\t<div class="column thirdal">\n\t\t\t\t\t\t\t\t<div class="cvasi_row"><div class="subtitle" :contenteditable="editable">{{castingTimeTitle}}</div> <div>{{castingTime}}</div></div>   \n\t\t\t\t\t\t\t\t<div class="cvasi_row"><div class="subtitle" :contenteditable="editable">{{rangeTitle}}</div> <div>{{range}}</div></div>           \n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="column thirdal">              \n\t\t\t\t\t\t\t\t<div class="cvasi_row"><div class="subtitle" :contenteditable="editable">{{componentsTitle}}</div> <div>{{components}} {{materials?"*":""}}</div></div> \n\t\t\t\t\t\t\t\t<div class="cvasi_row"><div class="subtitle" :contenteditable="editable">{{durationTitle}}</div> <div>{{duration}}</div></div>       \n\t\t\t\t\t\t\t</div> \n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="sizeButtonsContainer noprint">\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t\t<span class="textCancel noprint itemButton" title="–û—Ç–º–µ–Ω–∏—Ç—å" @click.stop=\'onTextCancel\' :style="editableButtons" >‚úñ</span>\n\t\t\t\t\t\t\t<span class="textSave noprint itemButton" title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å" @click.stop=\'onTextSave\' :style="editableButtons" >‚úî</span>\n\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t</div>\n          <div class="text" v-html="preparedText" :contenteditable="editable" ref="itemText"></div> \n          <div class="material_components" :contenteditable="editable">{{materialsLine}}</div>\n\t\t\t\t\t<div class="source" :title="srcTitle">({{src}})</div>\n        </div>\n\t\t\t</div>'}),Vue.component("hiddenitem",{props:{id:{type:String,default:""},title:{type:String,default:""},tooltip:{type:String,default:""}},data:function(){return{}},methods:{unhide:function(t){this.$emit("unhide",t)}},computed:{},template:"<a href='#' @click.stop=\"unhide\">{{title}} ({{tooltip}})</a>"});var e=new Vue({el:"#app",data:{aSources:sourceList,aSchools:schoolList,aCastingTime:{"1 action":{checked:!1,visible:!0,text:{en:{title:"1 action"},ru:{title:"1 –¥–µ–π—Å—Ç–≤–∏–µ"}}},"1 minute":{checked:!1,visible:!0,text:{en:{title:"1 minute"},ru:{title:"1 –º–∏–Ω—É—Ç–∞"}}},"1 bonus action":{checked:!1,visible:!0,text:{en:{title:"1 bonus action"},ru:{title:"1 –±–æ–Ω—É—Å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ"}}},"1 reaction":{checked:!1,visible:!0,text:{en:{title:"1 reaction"},ru:{title:"1 —Ä–µ–∞–∫—Ü–∏—è"}}},"1 hour":{checked:!1,visible:!0,text:{en:{title:"1 hour"},ru:{title:"1 —á–∞—Å"}}},"10 minutes":{checked:!1,visible:!0,text:{en:{title:"10 minutes"},ru:{title:"10 –º–∏–Ω—É—Ç"}}},"12 hours":{checked:!1,visible:!0,text:{en:{title:"12 hours"},ru:{title:"12 hours"}}},"1 action or 8 hours":{checked:!1,visible:!0,text:{en:{title:"1 action or 8 hours"},ru:{title:"1 –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ 8 —á–∞—Å–æ–≤"}}},"8 hours":{checked:!1,visible:!0,text:{en:{title:"8 hours"},ru:{title:"8 —á–∞—Å–æ–≤"}}},"24 hours":{checked:!1,visible:!0,text:{en:{title:"24 hours"},ru:{title:"24 —á–∞—Å–∞"}}},"1 reaction, which you take when a humanoid you can see within 60 feet of you dies":{checked:!1,visible:!0,text:{en:{title:"1 reaction, which you take when a humanoid you can see within 60 feet of you dies"},ru:{title:"1 —Ä–µ–∞–∫—Ü–∏—è"}}}},aLanguages:oLanguages,aViews:oView,aSort:oSort,aItems:allSpells,oClassSpells:classSpells,sLang:"ru",sView:"card",sSort:"levelAlpha",sClass:"",sSubClass:"",sSubSubClass:"",sSearch:"",aLevels:[0,1,2,3,4,5,6,7,8,9],sLevelStartSelected:"0",sLevelEndSelected:"9",nLevelStart:0,nLevelEnd:9,aHiddenItems:[],aLockedItems:[],aSelectedItems:[],aSelectedLockedItems:[],sTextSizeDefault:"",sCardwidth:"",sCardWidthDefault:"2.5in",oConfig:{},bSchoolsOpend:!1,bSourcesOpend:!1,bCastingTimeOpend:!1,bCardsAreVisible:!1,bAppIsReady:!1,bRitualOnly:!1,bAllClassSpells:!1,bEditMode:!1,bModalWinShow:!1,sModalWinCont:"",bDebug:!1,bIos:!1},computed:{sOtherLang:function(){return"ru"==this.sLang?"en":"ru"},aSrcList:function(){let t=[];for(var e in this.aSources)!1!==this.aSources[e].visible&&t.push({key:e,title:this.aSources[e].text.en.title+"<br>"+this.aSources[e].text.ru.title,subtitle:1==this.aSources[e].official?"":"Homebrew /–°–∞–º–æ–ø–∞–ª",official:this.aSources[e].official,checked:this.aSources[e].checked});return t.sort(((t,e)=>t.official?-1:1))},aCastingTimeList:function(){let t=[];for(var e in this.aCastingTime)!1!==this.aCastingTime[e].visible&&t.push({key:e,title:this.aCastingTime[e].text.en.title+"<br>"+this.aCastingTime[e].text.ru.title,checked:this.aCastingTime[e].checked});return t},aSrcSelected:function(){let t=this.aSrcList.filter((t=>t.checked));return t.length>0?t.map((t=>t.key)):this.aSrcList.map((t=>t.key))},aSchoolList:function(){let t=[],e=0;for(var s in this.aSchools)!1!==this.aSchools[s].visible&&(this.aSchools[s].i=e++,t.push({key:s,title:this.aSchools[s].text.en.title+"<br>"+this.aSchools[s].text.ru.title,checked:this.aSchools[s].checked}));return t},aSchoolSelected:function(){let t=this.aSchoolList.filter((t=>t.checked));return t.length>0?t.map((t=>t.key.toLowerCase())):this.aSchoolList.map((t=>t.key.toLowerCase()))},aCastingTimeSelected:function(){let t=this.aCastingTimeList.filter((t=>t.checked));return t.length>0?t.map((t=>t.key.toLowerCase())):[]},aLanguageList:function(){let t=[];for(var e in this.aLanguages)!1!==this.aLanguages[e].visible&&t.push({key:e,title:this.aLanguages[e].text[this.sLang].title});return t},sLangSelected:function(){return this.aLanguages[this.sLang].text[this.sLang].title},aViewList:function(){let t=[];for(var e in this.aViews)!1!==this.aViews[e].visible&&t.push({key:e,title:this.aViews[e].text[this.sLang].title});return t},sViewSelected:function(){return this.aViews[this.sView].text[this.sLang].title},aSortList:function(){let t=[];for(var e in this.aSort)!1!==this.aSort[e].visible&&t.push({key:e,title:this.aSort[e].text[this.sLang].title});return t},sSortSelected:function(){return this.aSort[this.sSort]||(this.sSort=Object.keys(this.aSort)[0]),this.aSort[this.sSort].text[this.sLang].title},aClassList:function(){let t=[{key:"",title:"[–í–°–ï]"}];for(let e in this.oClassSpells){let s=(this.oClassSpells[e].title.en.text||this.oClassSpells[e].title.en)+"<br>"+(this.oClassSpells[e].title.ru.text||this.oClassSpells[e].title.ru);t.push({key:e,title:s})}return t},aSubClassList:function(){let t=[{key:"",title:"[–ü–û–î–ö–õ–ê–°–°]"}];if(this.sClass&&this.oClassSpells[this.sClass].subclasses)for(let e in this.oClassSpells[this.sClass].subclasses){let s="";this.oClassSpells[this.sClass].subclasses[e].title.en.text?s+=this.oClassSpells[this.sClass].subclasses[e].title.en.text:s+=this.oClassSpells[this.sClass].subclasses[e].title.en,this.oClassSpells[this.sClass].subclasses[e].title.en.source&&(s+=" ("+this.oClassSpells[this.sClass].subclasses[e].title.en.source+")"),s+="<br>",this.oClassSpells[this.sClass].subclasses[e].title.ru.text?s+=this.oClassSpells[this.sClass].subclasses[e].title.ru.text:s+=this.oClassSpells[this.sClass].subclasses[e].title.ru,t.push({key:e,title:s})}return t},aSubSubClassList:function(){let t=[{key:"",title:"[–ü–û–î–ü–û–î–ö–õ–ê–°–°]"}];if(this.sClass&&this.oClassSpells[this.sClass].subclasses&&this.sSubClass&&this.oClassSpells[this.sClass].subclasses[this.sSubClass].subclasses)for(let e in this.oClassSpells[this.sClass].subclasses[this.sSubClass].subclasses){let s=(this.oClassSpells[this.sClass].subclasses[this.sSubClass].subclasses[e].title.en.text||this.oClassSpells[this.sClass].subclasses[this.sSubClass].subclasses[e].title.en)+"<br>"+(this.oClassSpells[this.sClass].subclasses[this.sSubClass].subclasses[e].title.ru.text||this.oClassSpells[this.sClass].subclasses[this.sSubClass].subclasses[e].title.ru);t.push({key:e,title:s})}return t},sClassSelected:function(){return this.sClass?this.oClassSpells[this.sClass].title[this.sLang]:"[–í–°–ï]"},sSubClassSelected:function(){return this.sSubClass?this.oClassSpells[this.sClass].subclasses[this.sSubClass].title[this.sLang]:"[–ü–û–î–ö–õ–ê–°–°]"},sSubSubClassSelected:function(){return this.sSubClass&&this.sSubSubClass?this.oClassSpells[this.sClass].subclasses[this.sSubClass].subclasses[this.sSubSubClass].title[this.sLang]:"[–ü–û–î–ü–û–î–ö–õ–ê–°–°]"},aLevelList:function(){return this.aLevels.map((t=>({key:t,title:t})))},sNameInput:function(){return this.sSearch.toLowerCase()},sClassTitle:function(){return this.sClass?this.oClassSpells[this.sClass].title[this.sLang]:""},aClassSpells:function(){let t=[];if(""!=this.sClass){if(this.bAllClassSpells){t=t.concat(this.oClassSpells[this.sClass].spells);for(let e in this.oClassSpells[this.sClass].subclasses){this.oClassSpells[this.sClass].subclasses[e].spells&&(t=t.concat(this.oClassSpells[this.sClass].subclasses[e].spells));for(let s in this.oClassSpells[this.sClass].subclasses[e].subclasses)this.oClassSpells[this.sClass].subclasses[e].subclasses[s].spells&&(t=t.concat(this.oClassSpells[this.sClass].subclasses[e].subclasses[s].spells))}}else t=t.concat(this.oClassSpells[this.sClass].spells),this.oClassSpells[this.sClass].subclasses&&this.sSubClass&&this.oClassSpells[this.sClass].subclasses[this.sSubClass]&&(this.oClassSpells[this.sClass].subclasses[this.sSubClass].spells&&(t=t.concat(this.oClassSpells[this.sClass].subclasses[this.sSubClass].spells)),this.oClassSpells[this.sClass].subclasses[this.sSubClass].subclasses&&this.sSubSubClass&&this.oClassSpells[this.sClass].subclasses[this.sSubClass].subclasses[this.sSubSubClass]&&(t=t.concat(this.oClassSpells[this.sClass].subclasses[this.sSubClass].subclasses[this.sSubSubClass].spells)));t=this.aItems.filter((e=>t.map((t=>t.toLowerCase().replace(/\s+/g,""))).indexOf(e.en.name.toLowerCase().replace(/\s+/g,""))>-1))}else t=this.aItems;return t},aItemsList:function(){return this.aClassSpells.filter(function(t){return this.aSrcSelected.filter((e=>-1!==t.en.source.split(",").map((t=>t.trim())).indexOf(e))).length&&this.aSchoolSelected.indexOf(t.en.school.toLowerCase().trim())>-1&&(0==this.aCastingTimeSelected.length||this.aCastingTimeSelected.indexOf(t.en.castingTime.toLowerCase().trim())>-1)&&(t.en.name.toLowerCase().indexOf(this.sNameInput)>-1||t.ru.name.toLowerCase().indexOf(this.sNameInput)>-1||t.ru.nic&&t.ru.nic.toLowerCase().indexOf(this.sNameInput)>-1)&&(this.bRitualOnly&&t.en.ritual||!this.bRitualOnly)&&this.aHiddenItems.indexOf(t.en.name)<0&&this.nLevelStart<=this.nLevelEnd&&this.nLevelStart<=Number(t.en.level)&&this.nLevelEnd>=Number(t.en.level)}.bind(this)).map(function(t){try{let e=t.en.source.split(",").map((t=>this.aSources[t.trim()].text[this.sLang].title)).join(", "),s={id:t.en.name,name:t[this.sLang].name||t.en.name,tooltip:t[this.sOtherLang].name||t.en.name,text:t[this.sLang].text||t.en.text,src:t[this.sLang].source||t.en.source,className:this.sClassTitle,source:e,school:this.aSchools[t.en.school.trim()].text[this.sLang].title,level:oLevelsText[t.en.level]?oLevelsText[t.en.level].text[this.sLang].title:t.en.level+" "+oLevelsText.units[this.sLang].title,castingTime:t[this.sLang].castingTime||t.en.castingTime,range:t[this.sLang].range||t.en.range,components:t[this.sLang].components||t.en.components,materials:t[this.sLang].materials||t.en.materials,duration:t[this.sLang].duration||t.en.duration,ritual:t.en.ritual?oDict.ritual[this.sLang].title:"",castingTimeTitle:oDict.castingTime[this.sLang].title,durationTitle:oDict.duration[this.sLang].title,rangeTitle:oDict.range[this.sLang].title,componentsTitle:oDict.components[this.sLang].title,levelNum:t.en.level,color:this.sClass,view:this.sView,locked:this.aLockedItems.indexOf(t.en.name)>-1,selected:this.aSelectedItems.indexOf(t.en.name)>-1,editable:this.bEditMode};return(t[this.sLang].pre||t.en.pre)&&(s.pre=t[this.sLang].pre||t.en.pre),s}catch(t){}}.bind(this)).sort(function(t,e){return"alpha"==this.sSort?t.name.toLowerCase().trim()<e.name.toLowerCase().trim()?-1:t.name.toLowerCase().trim()>e.name.toLowerCase().trim()?1:0:t.levelNum+t.name.toLowerCase().trim()<e.levelNum+e.name.toLowerCase().trim()?-1:t.levelNum+t.name.toLowerCase().trim()>e.levelNum+e.name.toLowerCase().trim()?1:0}.bind(this))},aLockedItemsList:function(){return this.aItems.filter(function(t){return this.aLockedItems.indexOf(t.en.name)>-1}.bind(this)).map(function(t){let e=t.en.source.split(",").map((t=>this.aSources[t.trim()].text[this.sLang].title)).join(", "),s={id:t.en.name,name:t[this.sLang].name||t.en.name,tooltip:t[this.sOtherLang].name||t.en.name,text:t[this.sLang].text||t.en.text,src:t[this.sLang].source||t.en.source,className:this.sClassTitle,source:e,school:this.aSchools[t.en.school.trim()].text[this.sLang].title,level:oLevelsText[t.en.level]?oLevelsText[t.en.level].text[this.sLang].title:t.en.level+" "+oLevelsText.units[this.sLang].title,castingTime:t[this.sLang].castingTime||t.en.castingTime,range:t[this.sLang].range||t.en.range,components:t[this.sLang].components||t.en.components,materials:t[this.sLang].materials||t.en.materials,duration:t[this.sLang].duration||t.en.duration,ritual:t.en.ritual?oDict.ritual[this.sLang].title:"",castingTimeTitle:oDict.castingTime[this.sLang].title,durationTitle:oDict.duration[this.sLang].title,rangeTitle:oDict.range[this.sLang].title,componentsTitle:oDict.components[this.sLang].title,levelNum:t.en.level,color:this.sClass,view:this.sView,locked:this.aLockedItems.indexOf(t.en.name)>-1,selected:this.aSelectedLockedItems.indexOf(t.en.name)>-1};return(t[this.sLang].pre||t.en.pre)&&(s.pre=t[this.sLang].pre||t.en.pre),s}.bind(this)).sort(function(t,e){return"alpha"==this.sSort?t.name.toLowerCase().trim()<e.name.toLowerCase().trim()?-1:t.name.toLowerCase().trim()>e.name.toLowerCase().trim()?1:0:t.levelNum+t.name.toLowerCase().trim()<e.levelNum+e.name.toLowerCase().trim()?-1:t.levelNum+t.name.toLowerCase().trim()>e.levelNum+e.name.toLowerCase().trim()?1:0}.bind(this))},aHiddenItemsList:function(){return this.aItems.filter(function(t){return this.aHiddenItems.indexOf(t.en.name)>-1}.bind(this)).map(function(t){return{id:t.en.name,title:t[this.sLang].name||t.en.name,tooltip:t[this.sOtherLang].name||t.en.name}}.bind(this))}},mounted:function(){this.loadConfigData(),this.collectCastingTime(),this.sModalWinCont=$("#info_text").html(),this.getConfig("infoIsRead")&&(this.hideInfo(),this.showCards()),this.getHash(),this.$refs.SchoolCombobox.toggle(null,this.bSchoolsOpend),this.$refs.SourceCombobox.toggle(null,this.bSourcesOpend),this.updateHash(),this.bAppIsReady=!0,this.bDebug=window.location.href.toLowerCase().indexOf("debug=true")>-1,this.bIos=function(){if(window.location.href.toLowerCase().indexOf("ios=true")>-1)return!0;if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream)return!0;var t=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;t.length;)if(navigator.platform===t.pop())return!0;return!1}()},methods:{collectCastingTime:function(){let t={};this.aItems.forEach((e=>t[e.en.castingTime]=e.ru.castingTime));for(let e in t)this.aCastingTime[e]={checked:!1,visible:!0,text:{en:{title:e},ru:{title:t[e]}}}},onClassChange:function(t){this.showAllItems(),this.sClass=t,this.setConfig("class",t),this.onSubClassChange(""),this.updateHash()},onSubClassChange:function(t){this.showAllItems(),this.sSubClass=t,this.setConfig("subclass",t),this.onSubSubClassChange(""),this.updateHash()},onSubSubClassChange:function(t){this.showAllItems(),this.sSubSubClass=t,this.setConfig("subsubclass",t),this.updateHash()},onLevelStartChange:function(t){this.showAllItems(),this.sLevelStartSelected=String(this.nLevelStart=t),this.setConfig("ls",t),this.updateHash()},onLevelEndChange:function(t){this.showAllItems(),this.sLevelEndSelected=String(this.nLevelEnd=t),this.setConfig("le",t),this.updateHash()},onSourceChange:function(t){this.showAllItems(),this.aSources[t].checked=!this.aSources[t].checked,this.updateHash()},onCastingTimeChange:function(t){this.showAllItems(),this.aCastingTime[t].checked=!this.aCastingTime[t].checked,this.updateHash()},onSchoolChange:function(t){this.showAllItems(),this.aSchools[t].checked=!this.aSchools[t].checked,this.updateHash()},onLanguageChange:function(t){this.showAllItems(),this.sLang=t,this.setConfig("lang",t),this.updateHash()},onViewChange:function(t){this.showAllItems(),this.sView=t,this.setConfig("view",t),this.updateHash()},onSortChange:function(t){this.showAllItems(),this.sSort=t,this.updateHash(),this.setConfig("sort",t)},onSearchName:function(t){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((()=>{this.bDebug&&alert("–í–≤–µ–¥–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: \r\n"+t),this.showAllItems(),this.sSearch=t.trim(),this.updateHash()}),500)},getRandomItem:function(){this.showAllItems(),this.sSearch="",this.sSearch=this.aItemsList[function(t,e){return Math.floor(arguments.length>1?(e-t+1)*Math.random()+t:(t+1)*Math.random())}(0,this.aItemsList.length-1)].name,this.updateHash()},onAllClassSpellsPress:function(){this.showAllItems(),this.bAllClassSpells=!this.bAllClassSpells,this.updateHash()},onRitualsPress:function(){this.showAllItems(),this.bRitualOnly=!this.bRitualOnly,this.updateHash()},autosizeAllText:function(){var t=this.$refs.itemCard;let e=setInterval(function(){if(t.length>0)for(let e=0;e<t.length;e++)t[e].autosizeText()||t.splice(e,1);else clearInterval(e)}.bind(this),1)},onSchoolsToggled:function(t){this.setConfig("schoolsOpend",t)},onSourcesToggled:function(t){this.setConfig("sourcesOpend",t)},onCastingTimeToggled:function(t){this.setConfig("castingTimeOpend",t)},hideInfo(){$("#info_text").hide()},lockCard:function(t){if(this.aSelectedItems.length>0)this.aSelectedItems.forEach(function(t){this.aSelectedItems.indexOf(t)>-1&&this.aLockedItems.push(t)}.bind(this)),this.selectAll(!1);else{let e=t.id;this.aLockedItems.indexOf(e)<0&&this.aLockedItems.push(e)}this.setConfig("locked",this.aLockedItems)},unlockCard:function(t){if(this.aSelectedLockedItems.length>0)this.aSelectedLockedItems.forEach(function(t){let e=this.aLockedItems.indexOf(t);e>-1&&this.aLockedItems.splice(e,1)}.bind(this));else{let e=t.id,s=this.aLockedItems.indexOf(e);s>-1&&this.aLockedItems.splice(s,1)}this.setConfig("locked",this.aLockedItems)},hideCard:function(t){if(this.aSelectedItems.length>0)this.aSelectedItems.forEach(function(t){this.aSelectedItems.indexOf(t)>-1&&this.aHiddenItems.push(t)}.bind(this)),this.selectAll(!1);else{let e=t.id;this.aHiddenItems.indexOf(e)<0&&this.aHiddenItems.push(e)}},unhideCard:function(t){let e=this.aHiddenItems.indexOf(t);e>-1&&this.aHiddenItems.splice(e,1)},unlockAll:function(){this.aLockedItems=[],this.setConfig("locked",this.aLockedItems)},unhideAll:function(){this.aHiddenItems=[]},selectCard:function(t){let e=t.id,s=this.aSelectedItems.indexOf(e);s>-1?this.aSelectedItems.splice(s,1):this.aSelectedItems.push(e)},selectLockedCard:function(t){let e=t.id,s=this.aSelectedLockedItems.indexOf(e);s>-1?this.aSelectedLockedItems.splice(s,1):this.aSelectedLockedItems.push(e)},selectAll:function(t){this.aSelectedItems.length>0||!1===t?(this.aSelectedItems=[],this.aSelectedLockedItems=[]):this.aSelectedItems=this.aItemsList.map((t=>t.id))},makeCardWidthLess:function(){var t=this.$refs.itemCard;(this.aSelectedLockedItems.length>0||this.aSelectedItems.length>0)&&(t=t.filter((t=>this.aSelectedLockedItems.indexOf(t.id)>-1||this.aSelectedItems.indexOf(t.id)>-1))),t.forEach(function(t){t.onCardWidthMin()}.bind(this))},makeCardWidthMore:function(){var t=this.$refs.itemCard;(this.aSelectedLockedItems.length>0||this.aSelectedItems.length>0)&&(t=t.filter((t=>this.aSelectedLockedItems.indexOf(t.id)>-1||this.aSelectedItems.indexOf(t.id)>-1))),t.forEach(function(t){t.onCardWidthMax()}.bind(this))},makeCardWidthNorm:function(){var t=this.$refs.itemCard;(this.aSelectedLockedItems.length>0||this.aSelectedItems.length>0)&&(t=t.filter((t=>this.aSelectedLockedItems.indexOf(t.id)>-1||this.aSelectedItems.indexOf(t.id)>-1))),t.forEach(function(t){t.setCardWidth(240)}.bind(this))},updateHash:function(){var t=[];this.sSearch.length>0&&t.push("q="+this.sSearch.trim()),this.aSrcSelected.length!=this.aSrcList.length&&t.push("src="+this.aSrcSelected.join(",")),this.aSchoolSelected.length!=this.aSchoolList.length&&t.push("school="+this.aSchoolSelected.join(",")),this.aCastingTimeSelected.length!=this.aCastingTime.length&&this.aCastingTimeSelected.length&&t.push("castTime="+this.aCastingTimeSelected.join(",")),"ru"!=this.sLang&&t.push("lang="+this.sLang),""!=this.sClass&&t.push("class="+this.sClass),this.nLevelStart>0&&t.push("ls="+this.nLevelStart),this.nLevelEnd<9&&t.push("le="+this.nLevelEnd),"card"!=this.sView&&t.push("view="+this.sView),"levelAlpha"!=this.sSort&&t.push("sort="+this.sSort),this.bRitualOnly&&t.push("ritual=1"),this.bAllClassSpells&&t.push("fullclass=1"),t.length>0?window.location.hash=t.join("&").replace(/\s+/g,"_"):this.removeHash()},removeHash:function(){return history.pushState("",document.title,window.location.pathname+window.location.search),!1},getHash(){var t=window.location.hash.slice(1);t=decodeURIComponent(t).replace(/_/g," ");var e={};if(t.split("&").forEach(function(t){aPair=t.split("="),aPair[1]&&(e[aPair[0]]=aPair[1].split(","))}.bind(this)),e.src)for(let t in this.aSources)e.src.indexOf(t)>-1?this.aSources[t].checked=!0:this.aSources[t].checked=!1;if(e.school)for(let t in this.aSchools)e.school.indexOf(t)>-1?this.aSchools[t].checked=!0:this.aSchools[t].checked=!1;if(e.castTime)for(let t in this.aCastingTime)e.castTime.indexOf(t)>-1?this.aCastingTime[t].checked=!0:this.aCastingTime[t].checked=!1;e.lang&&(this.sLang=e.lang[0]),e.class&&(this.sClass=e.class[0]),e.le&&(this.nLevelEnd=e.le[0]),e.ls&&(this.nLevelStart=e.ls[0]),e.view&&(this.sView=e.view[0]),e.sort&&(this.sSort=e.sort[0]),e.q&&(this.sSearch=e.q[0]),e.ritual&&(this.bRitualOnly=!0),e.fullclass&&(this.bAllClassSpells=!0)},showInfo:function(){this.bModalWinShow=!0},closeModWin:function(){this.bModalWinShow=!1},print:function(){return window.print(),!1},showCards:function(){this.bCardsAreVisible=!0},showAllItems:function(){this.closeModWin(),this.hideInfo(),this.showCards(),this.setConfig("infoIsRead",!0)},setConfig:function(t,e){t&&null!=e&&this.oConfig&&(this.oConfig[t]=e,localStorage.setItem("feat_config",JSON.stringify(this.oConfig)))},getConfig:function(t){return this.oConfig=JSON.parse(localStorage.getItem("feat_config"))||{},null!=t?localStorage.getItem("feat_config")?this.oConfig[t]:null:""},loadConfigData:function(){let t=this.getConfig("lang");t&&(this.sLang=t);let e=this.getConfig("sort");e&&(this.sSort=e);let s=this.getConfig("locked");s&&(this.aLockedItems=s);let i=this.getConfig("schoolsOpend");null!=i&&(this.bSchoolsOpend=i);let n=this.getConfig("sourcesOpend");null!=n&&(this.bSourcesOpend=n)},downloadDB:function(){var t={};t.sourceList=this.aSources,t.schoolList=this.aSchools,t.oLanguages=this.aLanguages,t.allSpells=this.aItems,t.lockedItems=this.aLockedItems;var e=JSON.stringify(t,null,2),s=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(s,"DnD5e_spells_BD.dtn")},uploadDB:function(){this.$refs.fileUploader,document.getElementById("fileUploader").click()},fileSelected:function(t){this.handleLocalBDSelect(t)},handleLocalBDSelect:function(t){var e=t.target.files,s=new FileReader;s.onload=function(t){return function(t){var e=t.target.result;this.parceLocalFile(e)}.bind(this)}.bind(this)(e[0]),s.readAsText(e[0])},_completeDB:function(t,e){for(var s in e)t[s]=e[s]},parceLocalFile:function(t){try{var e=JSON.parse(t);this._completeDB(this.aSources,e.sourceList),this._completeDB(this.aSchools,e.schoolList),this._completeDB(this.aLanguages,e.oLanguages),this._completeDB(this.aLockedItems,e.lockedItems),this.aItems=e.allSpells,this.$refs.fileUploader,document.getElementById("fileUploader").value="",alert("–í—Ä–æ–¥–µ –∫–∞–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–æ")}catch(t){document.getElementById("fileUploader").value="",alert("–û—à–∏–±–∫–∞ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ñ–∞–π–ª–∞ —Ñ–∞–π–ª–∞. –í–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–º JSON.\n\n"+t)}},onEditModePress:function(){this.bEditMode=!this.bEditMode},cancelCard:function(t){let e=t.id,s=this.aItems.find((t=>t.en.name.toLowerCase().replace(/\s+/,"")==e.toLowerCase().replace(/\s+/,"")));if(s){let t=s[this.sLang].text+"  ";s[this.sLang].text=t}return!1},saveCard:function(t){let e=t.id,s=t.text,i=this.aItems.find((t=>t.en.name.toLowerCase().replace(/\s+/,"")==e.toLowerCase().replace(/\s+/,"")));return i&&(i[this.sLang].text=s),!1}}});$(document).keydown((function(s){if("17"==s.which&&(t=!0),"65"==s.which&&t)return e.selectAll(),!1})),$(document).keyup((function(){t=!1}))})();